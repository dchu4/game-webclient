var game = new Phaser.Game(800,600,Phaser.AUTO,'canvas',{preload: preload, create: create, update: update});

var star;
var characters;
var character;
var character2;
var cursors;


GameCharacter = function(game, name, hp, attack){
  var x = game.world.randomX;
  var y = game.world.randomY;

  Phaser.Sprite.call(this, game, x, y,'dude');

  this.charName = name;
  this.charHp = hp;
  this.charAttack = attack;


  game.physics.enable(this, Phaser.Physics.ARCADE);
  this.enableBody = true;
  this.body.immovable = false;
  this.body.collideWorldBounds = true;
  this.body.setSize(20,32,5,16);

  this.player = game.add.existing(this);
}

GameCharacter.prototype = Object.create(Phaser.Sprite.prototype);
GameCharacter.prototype.constructor = GameCharacter;

GameCharacter.prototype.update = function(){
  moveCharacter(this);
  //game.physics.arcade.collide(this,star);
};

function preload(){
  game.load.image('sky','<%= asset_path "sky.png" %>');
  game.load.image('star','<%= asset_path "star.png" %>');
  game.load.spritesheet('dude','<%= asset_path "dude.png" %>',32,48);

}

function create(){
  game.physics.startSystem(Phaser.Physics.ARCADE);
  game.add.sprite(0,0,'sky');
  star = game.add.sprite(200,200,'star');
  game.physics.enable(star);
  star.body.enableBody = true;

  character = new GameCharacter(game,"tester",200,20);

  cursors = game.input.keyboard.createCursorKeys();

  //character = new GameCharacter(game, "Tester", 200, 20);
  //console.log(character.player);
}

function update(){
  //game.physics.arcade.overlap(character.player, character2.player, star.kill(), null, this);
  //game.physics.arcade.overlap(character, star, collectStar, null, this);
  //moveCharacter(characters[0].player);
  //character.characterCollision(character2.player);
  //game.physics.arcade.collide(character,star);
  //game.physics.arcade.overlap(character.player, star, console.log(100), null, this);
  moveCharacter(character);

  return{
    preload: preload,
    create: create,
    update: update
  };
}

function collectStar(player, star){
  star.kill();
}

moveCharacter = function(player){
  player.body.velocity.x = 0
  player.body.velocity.y = 0

  if(cursors.left.isDown){
    player.body.velocity.x = -200;

    player.animations.play('left');
  }
  else if(cursors.right.isDown){
    player.body.velocity.x = 200;

    player.animations.play('right');
  }
  else{
    player.animations.stop();
  }

  if(cursors.up.isDown){
    player.body.velocity.y = -200
  }
  else if(cursors.down.isDown){
    player.body.velocity.y = 200
  }
}

